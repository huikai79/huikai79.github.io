{{ define "main" }}
<article class="prose dark:prose-invert mx-auto">

  {{/* ---- Cover ---------------------------------------------------------- */}}
  {{- with .Resources.GetMatch "cover*" -}}
    {{/* 16 : 9 裁剪三份（sm / md / lg）*/}}
    {{ $sm := .Fill "800x450 center"   }}
    {{ $md := .Fill "1280x720 center"  }}
    {{ $lg := .Fill "1920x1080 center" }}

    <figure class="mb-6 overflow-hidden rounded-xl">
      <picture class="block">
        <source media="(min-width:1024px)" srcset="{{ $lg.RelPermalink }}">
        <source media="(min-width:768px)"  srcset="{{ $md.RelPermalink }}">
        <img  src="{{ $sm.RelPermalink }}"
              alt="{{ $.Title }}"
              class="w-full max-h-[80vh] object-cover"
              loading="lazy">
      </picture>
    </figure>
  {{- end }}

  {{/* ---- 标题 + Icon ---------------------------------------------------- */}}
  <h1 class="flex items-center gap-2">
    {{- with .Params.icon -}}
      {{- if hasPrefix . "images/" -}}
        <img src="{{ . | relURL }}" class="w-8 h-8" alt="icon" loading="lazy">
      {{- else -}}
        <span class="text-3xl">{{ . }}</span>
      {{- end -}}
    {{- end -}}
    {{ .Title }}
  </h1>

  <p class="text-sm opacity-70 mb-8">
    {{ .Date.Format "02 January 2006" }} · {{ .ReadingTime }} min
  </p>

  {{ .Content }}

  {{/* ----- Author card --------------------------------------------------- */}}
  {{ if templates.Exists "partials/article/author.html" }}
    {{ partial "article/author.html" . }}
  {{ end }}

  {{/* ----- Prev / Next --------------------------------------------------- */}}
  {{ if templates.Exists "partials/article/pagination.html" }}
    {{ partial "article/pagination.html" . }}
  {{ end }}

  {{/* ----- Related ------------------------------------------------------- */}}
  {{ if templates.Exists "partials/article/related.html" }}
    {{ partial "article/related.html" . }}
  {{ end }}

</article>
{{ end }}
